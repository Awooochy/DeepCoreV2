using DeepCore.Client.Misc;
using VRC.SDKBase;

namespace DeepCore.Client.Module.Exploits
{
    internal class OwnerNameSpoofer
    {
        public static string CustomName = "";
        public static bool Enabled = false;
        public static void State(bool s)
        {
            if (s)
            {
                PopupHelper.PopupCall("OwnerSpoofer", "Enter an username", "Set", false, userInput =>
                {
                    CustomName = userInput;
                    Enabled = true;
                });
            }
            else
            {
                Enabled = false;
            }
        }
        public static void QuickSpoof()
        {
            if (Enabled)
            {
                if (VRCPlayer.field_Internal_Static_VRCPlayer_0 == null)
                {
                }
                if (string.IsNullOrEmpty(CustomName))
                {
                    DeepConsole.LogConsole("QuickSpoof", "Error: CustomName is null or empty.");
                }
                string currentDisplayName = Networking.LocalPlayer.displayName;
                string customName = CustomName;
                VRCPlayer.field_Internal_Static_VRCPlayer_0.field_Private_VRCPlayerApi_0.displayName = customName;
                DeepConsole.Log("OwnerSpoof", "Spoofed as: " + currentDisplayName + " | CustomName: " + customName);
                if (VRCPlayer.field_Internal_Static_VRCPlayer_0.field_Private_VRCPlayerApi_0.displayName == customName)
                {
                    DeepConsole.Log("QuickSpoof", "Spoofing successful!");
                }
                else
                {
                    DeepConsole.Log("QuickSpoof", "Spoofing failed. DisplayName mismatch.");
                }
            }
            else
            {
            }
        }
        public static void Update()
        {
            if (Enabled) 
            {
                if (PlayerUtil.GetLocalVRCPlayer().field_Private_VRCPlayerApi_0 != null)
                {
                    PlayerUtil.GetLocalVRCPlayer().field_Private_VRCPlayerApi_0.displayName = CustomName;
                    DeepConsole.Log("OwnerSpoof", $"Spoofed as :{PlayerUtil.GetLocalVRCPlayer().field_Private_VRCPlayerApi_0.displayName} | CustomName:{CustomName}");
                    VrcExtensions.Toast("OwnerSpoof", $"Spoofed as :{PlayerUtil.GetLocalVRCPlayer().field_Private_VRCPlayerApi_0.displayName} | CustomNAme:{CustomName}");
                    Enabled = false;
                }
            }
        }
    }
}
